{% extends "layout.html" %}

{% block content %}

{% include "geo_libs.html" %}
{% block js_css %}

    <script src="{{ url_for('static', filename='js/uts/buildmap_reci.js') }}"></script>
    <!--<script src="{{ url_for('static', filename='js/uts/buildmap.js') }}"></script>-->
    <script type="text/javascript" src="{{ url_for('static', filename='js/uts/cargar.js') }}"></script>

{% endblock %}


<script>

// Para visor en asientos/recintos a partir de coordenadas
// -ric
function getgeoext(event) {
    var x = event.keyCode;
    //alert(x)
    if (x == 27 || x == 9 || 'undefined') {          
        buildMap($('input[name="latitud"]').val(),   $('input[name="longitud"]').val());
    };
} //getgeo


function getgeoesp(event) {
    var x = event.keyCode;
    //alert(x)
    var ban=0;
    if (x == 27 || x == 9 || 'undefined') {
            $.getJSON('/get_geo_esp', {
                latitud: $('input[name="latitud"]').val(),
                longitud: $('input[name="longitud"]').val()
            }, function(data) {
                document.getElementById("ideploc").setAttribute("value", data.dep)
                document.getElementById("idepartamento").setAttribute("value", data.departamento)
                document.getElementById("iprovloc").setAttribute("value", data.prov)
                document.getElementById("iprovincia").setAttribute("value", data.provincia)
                document.getElementById("isecloc").setAttribute("value", data.sec)
                document.getElementById("imunicipio").setAttribute("value", data.municipio)
                //document.getElementById("icircun").setAttribute("value", data.dep);
                //document.getElementById("icircun").setAttribute("value", circun(3));
                switch(data.dep){
                    case 2:{
                        document.getElementById("icircun").setAttribute("value", '1');
                        $('#icircun').css('color', 'black');
                    }
                    break;
                    case 3:{
                        document.getElementById("icircun").setAttribute("value", '2');
                        $('#icircun').css('color', 'black');   
                    }
                    break;
                    case 4:{
                        document.getElementById("icircun").setAttribute("value", '3');
                        $('#icircun').css('color', 'black');   
                    }
                    break;
                    case 6:{
                        document.getElementById("icircun").setAttribute("value", '4');
                        $('#icircun').css('color', 'black');   
                    }
                    break;
                    case 7:{
                        document.getElementById("icircun").setAttribute("value", '5');   
                    }
                    break;
                    case 8:{
                        document.getElementById("icircun").setAttribute("value", '6');
                        $('#icircun').css('color', 'black');  
                    }
                    break;
                    case 9:{
                        document.getElementById("icircun").setAttribute("value", '7');
                        $('#icircun').css('color', 'black');  
                    }
                    break;
                    default:{ 
                        document.getElementById("icircun").setAttribute("value", 'No Hay');
                        $('#icircun').css('color', 'red');
                    } 
                    break;
                }
            });
        buildMap($('input[name="latitud"]').val(),   $('input[name="longitud"]').val());
    };
} //getgeo


function getgeo(event) {
    var x = event.keyCode;
    //alert(x)
    if (x == 27 || x == 9 || 'undefined') {
            $.getJSON('/get_geo', {
                latitud: $('input[name="latitud"]').val(),
                longitud: $('input[name="longitud"]').val()
            }, function(data) {
                document.getElementById("ideploc").setAttribute("value", data.dep)
                document.getElementById("idepartamento").setAttribute("value", data.departamento)
                document.getElementById("iprovloc").setAttribute("value", data.prov)
                document.getElementById("iprovincia").setAttribute("value", data.provincia)
                document.getElementById("isecloc").setAttribute("value", data.sec)
                document.getElementById("imunicipio").setAttribute("value", data.municipio)
                document.getElementById("icircun").setAttribute("value", data.nrocircun)
            });
          
        buildMap($('input[name="latitud"]').val(),   $('input[name="longitud"]').val());
    };
} //getgeo

function getgeoespecial(event) {
    var x = event.keyCode;
    //alert(x)
    if (x == 27 || x == 9 || 'undefined') {
            $.getJSON('/get_geo', {
                latitud: $('input[name="latitud"]').val(),
                longitud: $('input[name="longitud"]').val()
            }, function(data) {
                document.getElementById("ideploc").setAttribute("value", data.dep)
                document.getElementById("idepto").setAttribute("value", data.departamento)
                document.getElementById("iprovloc").setAttribute("value", data.prov)
                document.getElementById("iprovi").setAttribute("value", data.provincia)
                document.getElementById("isecloc").setAttribute("value", data.sec)
                document.getElementById("imuni").setAttribute("value", data.municipio)
                document.getElementById("icircun").setAttribute("value", data.nrocircun)
            });
        var select=document.getElementById("idepartamento");
        // obtenemos el valor a buscar
        var buscar=document.getElementById("idepto").value;
        // recorremos todos los valores del select
        for(var i=1;i<select.length;i++)
        {
            if(select.options[i].text.trim() === buscar.trim()){
                select.selectedIndex=i;
            }
        }  
        var dep=document.getElementById("ideploc").value;
        var prov=document.getElementById("iprovloc").value;
        $('#iprovincia').html('');
        $('#imunicipio').html('');
        $.getJSON("/get_provespeciales_all1", {
            dep: dep,
            prov: prov
        }, function(datos){
            $("#iprovincia").append('<option></option>');                
            $.each(datos, function(index, obj){
                if(obj[1]==prov){
                    $("#iprovincia").append('<option value="' + obj[1] + '" selected>' + obj[2] + '</option>');
                }else{
                    $("#iprovincia").append('<option value="' + obj[1] + '">' + obj[2] + '</option>');
                }           
            });
        });

        var muni=document.getElementById("isecloc").value;
        $('#imunicipio').html('');
        $.getJSON("/get_muniespeciales_all1", {
            dep: dep,
            prov: prov,
            muni: muni
        }, function(datos1){
            console.log(datos1);
            $("#imunicipio").append('<option></option>');                
            $.each(datos1, function(index1, obj1){
                if(obj1[2]==muni){
                    $("#imunicipio").append('<option value="' + obj1[2] + '" selected>' + obj1[3] + '</option>');
                }else{
                    $("#imunicipio").append('<option value="' + obj1[2] + '">' + obj1[3] + '</option>');
                }           
            });
        });

        buildMap($('input[name="latitud"]').val(),   $('input[name="longitud"]').val());
    };
} 

function buildMap(lat,lon)  {
    document.getElementById('dmap').innerHTML = "<div id='map' style='width: 100%; height: 100%;'></div>";

        var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
            osmAttrib = 'only osmAttrib',
            landUrl = 'http://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png',
            thunAttrib = 'only Attrib',
            googleSatUrl = 'https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',
            googleMapUrl = 'https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}',
            mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibzJicGlja2luIiwiYSI6ImNpbXUyMzNldTAyNTF1cmtrZXdnbWZycDIifQ.JdYE50MBxDn1fdZtVFYXZw';

        var osmMap = L.tileLayer(osmUrl, {attribution: ''}),
            landMap = L.tileLayer(landUrl, {attribution: ''}),
            googleSat = L.tileLayer(googleSatUrl, {Attribution: 'gsat'}),
            googleMap = L.tileLayer(googleMapUrl, {Attribution: 'gmap'}),
            mbStreet = L.tileLayer(mbUrl, {id: 'mapbox.streets', attribution: 'mbSat'}), 
            mbSat = L.tileLayer(mbUrl, {id: 'mapbox.satellite', attribution: 'mbSat'}) ;

        var map = L.map('map', {
			    layers: [googleSat] // only add one!
		    })
		    .setView([lat, lon], 15);

		var baseLayers = {
			"OSM Mapnik": osmMap,
			"Landscape": landMap,
			"Google Satellite": googleSat,
            "Google Map": googleMap,
            "MapBox Satellite": mbSat,
            "MapBox Streets": mbStreet
		};


		L.control.layers(baseLayers).addTo(map);

    // to marker --
        //iconUrl: "https://unpkg.com/leaflet@1.5.1/dist/images/marker-icon.png",
        //shadowUrl: "https://unpkg.com/leaflet@1.5.1/dist/images/marker-shadow.png"
    const markerIcon = L.icon({
        iconSize: [25, 41],
        iconAnchor: [10, 41],
        popupAnchor: [2, -40],
        // specify the path here
        iconUrl:   "../../static/css/leaflet1.5.1/images/marker-icon.png",
        shadowUrl: "../../static/css/leaflet1.5.1/images/marker-shadow.png"
    });

    L.marker([lat, lon],
        {
            title: "Asiento",
            opacity: 0.8,
            icon: markerIcon
        }
    ).addTo(map);

    L.circle([lat, lon], {
            color: 'red',
            fillColor: '#f03',
            fillOpacity: 0.06,
            radius: 500
        }).addTo(map);
} //buildMap


function buildMapCoordIni(lat,lon)  {

  $.getJSON('/get_json_ptos', {
      latitud: $('input[name="latitud"]').val(),
      longitud: $('input[name="longitud"]').val()
  }, function(data) {
    /*
      document.getElementById("idepartamento").setAttribute("value", data.gj_ptos)
    */
    alert(data.gj_ptos.name);
  });
}

//--------------------------------------------------------------------------------------------

// ---------------------------------------------------------was  viewmap.js
    // Set style function that sets fill color property
    function style(feature) {
        return {
            fillColor: 'green', 
            fillOpacity: 0.5,  
            weight: 2,
            opacity: 1,
            color: '#ffffff',
            dashArray: '3'
        };
    }

    function styleProv(feature) {
        return {
            fillColor: 'orange', 
            fillOpacity: 0.5,  
            weight: 2,
            opacity: 1,
            color: '#ffffff',
            dashArray: '3'
        };
    }

    function styleCir(feature) {
        return {
            fillColor: 'gray', 
            fillOpacity: 0.5,  
            weight: 2,
            opacity: 1,
            color: 'red',
            dashArray: '3'
        };
    }


    var highlight = {
      'fillColor': 'yellow',
      'weight': 2,
      'opacity': 2
    };
    

    var highlightCir = {
      'fillColor': '#a3c2c2',
      'weight': 2,
      'opacity': 2
    };


    function forEachFeature(feature, layer) {
        var popupContent = "<p><b>ID: </b>"+ feature.properties.id +
            "</br>LOCALIDAD: "+ feature.properties.nom_localidad + '</p>';

        layer.bindPopup(popupContent);

        layer.on("click", function (e) { 
            locLayer.setStyle(style); //resets layer colors
            layer.setStyle(highlight);  //highlights selected.
        }); 
    }

/*
    function forEachFeatureReci(feature, layer) {
      var popupContent = "<p><b><span style='color:blue'>Recinto: </b></span>" + '<b><big>' + feature.properties.recinto + '</big></b>' +
            "</br><b><span style='color:blue'>Idloc/Reci: </b></span>"+ feature.properties.idlocreci + 
            "</br><b><span style='color:blue'>Dep/Prov/Municipio: </b></span>"+ feature.properties.dpm + 
            "</br><b><span style='color:blue'>Cod. Dep/Prov/Municipio: </b></span>"+ feature.properties.cod + 
            "</br><b><span style='color:blue'>Circunscripción: </b></span>"+ feature.properties.circun + 
            "</br><b><span style='color:blue'>Zona: </b></span>"+ feature.properties.zona + 
            "</br><b><span style='color:blue'>Dirección:  </b></span>"+ feature.properties.direccion + 
            '</p>';

        layer.bindPopup(popupContent);

        layer.on("click", function (e) { 
            reciLayer.setStyle(style); //resets layer colors
            reciLayer.setStyle(highlight);  //highlights selected.
        }); 
    }
*/
/*
    function forEachFeatureAsi(feature, layer) {
        var popupContent = "<p><b><span style='color:blue'>Asiento: </b></span>" + feature.properties.asiento +
            "</br><b><span style='color:blue'>Idloc: </b></span>"+ feature.properties.idloc + 
            "</br><b><span style='color:blue'>Dep/Prov/Municipio: </b></span>"+ feature.properties.dpm + 
            "</br><b><span style='color:blue'>Cod. Dep/Prov/Municipio: </b></span>"+ feature.properties.cod + 
            "</br><b><span style='color:blue'>Tipo Circunscripción: </b></span>"+ feature.properties.tipo_circun + 
            '</p>';

        layer.bindPopup(popupContent);

        layer.on("click", function (e) { 
            reciLayer.setStyle(style); //resets layer colors
            reciLayer.setStyle(highlight);  //highlights selected.
        }); 
    }
*/


    function forEachFeatureMun(feature, layer) {
        var popupContent = "<p><b><span style='color:blue'>Cod.: </span></b>"+ feature.properties.cod +
          "</br><b><span style='color:blue'>Municipio: </span></b>"+ feature.properties.municipio + '</p>';

        layer.bindPopup(popupContent);

        layer.on("click", function (e) { 
            munLayer.setStyle(style); //resets layer colors
            layer.setStyle(highlight);  //highlights selected.
        }); 
    }
      

    function forEachFeatureProv(feature, layer) {
        var popupContent = "<p><b><span style='color:blue'>Cod.: </span></b>"+ feature.properties.cod +
          "</br><b><span style='color:blue'>Provincia: </span></b>"+ feature.properties.provincia + '</p>';

        layer.bindPopup(popupContent);

        layer.on("click", function (e) { 
            provLayer.setStyle(styleProv); //resets layer colors
            layer.setStyle(highlight);  //highlights selected.
        }); 
    }


    function forEachFeatureCir(feature, layer) {
        var popupContent = "<p><b>Circunscripción: </b>"+ feature.properties.circun + "</p";

        layer.bindPopup(popupContent);

        layer.on("click", function (e) { 
            cirLayer.setStyle(styleCir); //resets layer colors
            layer.setStyle(highlightCir);  //highlights selected.
        }); 
    }


    function markerOnClick(e)
    {
      var coord = e.latlng.toString().split(',');
      var lat = coord[0].split('(');
      var lng = coord[1].split(')');
      marker.bindPopup('Latitud:: ' + lat[1] + '  Longitud: ' + lng[0]);
    }


// invoked ---------------------------------------------cfg/view/coord in  map--------------------------
function viewMap() {
    document.getElementById('dmap').innerHTML = "<div id='map' style='width: 100%; height: 100%;'></div>";

    // add markerClusterGroup
    var markersMCG = L.markerClusterGroup();


    //tmp--var locLayer = L.geoJson( {{ geo_json | safe }}, {onEachFeature: forEachFeature, style: style});

    /*
    // reciLayer
    var iconReci = L.icon({
      iconUrl: '../static/iconos/icons8-map-pin-40.png',
      iconSize: [35, 35]
    });

    var reciLayer = L.geoJson( {{ gj_reci | safe }}, {
      pointToLayer: function (feature, latlng) {
        var lm = L.marker(latlng, {icon: iconReci});
        markersMCG.addLayer(lm);
        return lm;
    },
      onEachFeature: forEachFeatureReci, style: style
    });


    // asiLayer
    var iconAsi = L.icon({
      iconUrl: '../static/iconos/icons8-map-pin-40-red.png',
      iconSize: [35, 35]
    });

    var asiLayer = L.geoJson( {{ gj_asi | safe }}, {
      pointToLayer: function (feature, latlng) {
        var lma = L.marker(latlng, {icon: iconAsi});
        return lma;
    },
      onEachFeature: forEachFeatureAsi, style: style
    });
    */

    var munLayer = L.geoJson( {{ gj_mun | safe }}, {onEachFeature: forEachFeatureMun, style: style});
    var provLayer = L.geoJson( {{ gj_prov | safe }}, {onEachFeature: forEachFeatureProv, style: styleProv});
    var cirLayer = L.geoJson( {{ gj_cir | safe }}, {onEachFeature: forEachFeatureCir, style: styleCir});


    // baseMaps - overlayMaps

    var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
        osmAttrib = 'Map data &copy; OpenStreetMap contributors',
        landUrl = 'http://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png',
        thunAttrib = 'only Attrib',
        googleSatUrl = 'https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',
        googleMapUrl = 'https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}',
        mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibzJicGlja2luIiwiYSI6ImNpbXUyMzNldTAyNTF1cmtrZXdnbWZycDIifQ.JdYE50MBxDn1fdZtVFYXZw',
        topoUrl = 'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',
        topoAttrib = 'Kartendaten: &copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>-Mitwirkende, <a href="http://viewfinderpanoramas.org">SRTM</a> | Kartendarstellung: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)';

    var osmMap = L.tileLayer(osmUrl, {attribution: osmAttrib}),
        landMap = L.tileLayer(landUrl, {attribution: ''}),
        googleSat = L.tileLayer(googleSatUrl, {Attribution: 'gsat'}),
        googleMap = L.tileLayer(googleMapUrl, {Attribution: 'gmap'}),
        mbSat = L.tileLayer(mbUrl, {id: 'mapbox.satellite', attribution: 'mbSat'}) ;
        topoMap = new L.TileLayer(topoUrl, {minZoom: 1, maxZoom: 17, detectRetina: false, attribution: topoAttrib});

    var BING_KEY = 'AuhiCJHlGzhg93IqUH_oCpl_-ZUrIE6SPftlyGYUvr9Amx5nzA-WqGcPquyFZl4L';
    var bingSat = L.tileLayer.bing(BING_KEY);
    var esriStreets = L.esri.basemapLayer('Streets');
    var esriImagery = L.esri.basemapLayer('Imagery');

    var tokenMapBox = 'pk.eyJ1IjoibWJ1Z2xlMjAyMSIsImEiOiJja3FpOHd4cjMyYmR0MnpuMHZrajF5c3pxIn0.2gFzBGWekEI59pMl0EflSw';
    var mapboxUrl = 'https://api.mapbox.com/styles/v1/mapbox/streets-v10/tiles/{z}/{x}/{y}@2x?access_token=' + tokenMapBox;
    var mapboxAttrib = 'Map data © <a href="http://osm.org/copyright">OpenStreetMap</a> contributors. Tiles from <a href="https://www.mapbox.com">Mapbox</a>.';
    var mapboxStreets = new L.TileLayer(mapboxUrl, {
      attribution: mapboxAttrib,
      tileSize: 512,
      zoomOffset: -1
    });

    var baseLayers = {
      "Open Street Map": osmMap,
      "Google Satellite": googleSat,
      "Google Streets": googleMap,
      "MapBox Satellite": mbSat,
      "MapBox Streets": mapboxStreets,
      "Esri Streets": esriStreets,
      "Esri Imagery": esriImagery,
      "Bing Satellite": bingSat,
      "Landscape": landMap,
      "Open TopoMap": topoMap
    };
/*
      "Recintos Electorales":reciLayer,
      "Cluster-Recintos Elect.":markersMCG,
      "Asientos Electorales":asiLayer,
      */      
    var overlayMaps = {
      "Circunscripciones":cirLayer,
      "Municipios":munLayer,
      "Provincias":provLayer
    };	
      

    // Set up map

    var mapCenter = [-17.05678, -64.81934];
    var map = L.map('map', {
      defaultExtentControl: true,
      center: mapCenter,
      zoom: 6,
      layers: [mapboxStreets] // only add one!
    });

    //Add layer control
    L.control.layers(baseLayers, overlayMaps).addTo(map);

    // Add defaultExtent
    //L.control.defaultExtent().addTo(map);


    // add others controls 
    map.addControl(new L.Control.Fullscreen());

    map.addControl(new L.Control.LinearMeasurement({
      unitSystem: 'metric',
      color: '#FF6600'
    }))

    L.control.locate({
      strings: {title: "Ver donde estoy.."}
    }).addTo(map);

    //----- Add the Street View buttons in the bottom left corner -----
    // (Please get your own Client ID on https://www.mapillary.com/app/settings/developers)
    var iconStreet = L.icon({
        iconUrl: '../static/iconos/icons8-street-view-52.png',
        iconSize: [52, 52]
        })
    var marker_gsv = L.marker(map.getCenter(), {icon:iconStreet});
    map.on('move', function() { marker_gsv.setLatLng(map.getCenter()); });


    //----- Add easyButton gsv - StreetView-----
    var sw_marker_gsv = 0;
    var gsvPopup = L.popup().setContent('<u><i>Servicio</i></u>: <b>Google Street View (GSV)</b> \
            y otros Habilitado. Ubique posición y presione click en opciones  \
            (ubicado en la parte inferior/izquierda) ');

    L.easyButton('<img src="../static/iconos/icons8-street-view-26.png" style="width:23px">', function(btn, map){
      if (sw_marker_gsv == 0) {
         sv = L.streetView({ position: 'bottomleft', mapillaryId: 'RC1ZRTBfaVlhWmJmUGVqRk5CYnAxQTpmMGE3OTU0MzM0MTljZTA4' }).addTo(map);
         gsvPopup.setLatLng(map.getCenter()).openOn(map);
         marker_gsv.addTo(map);
         sw_marker_gsv = 1;
         }
      else {
         sv.remove();
         map.removeLayer(marker_gsv);
         gsvPopup.removeFrom(map);
         sw_marker_gsv = 0;
         }
      },'Habilitar/Inhabilitar Google Street View (GSV)').addTo(map);
    // end Street View - easyButton


    L.control.coordinates({
      position:"bottomleft",
      decimals:5,
      decimalSeperator:",",
      lngFirst:true,
      labelTemplateLat:"<b>Latitud:</b> {y}",
      labelTemplateLng:"<b>Longitud:</b> {x}",
      useLatLngOrder: true
    }).addTo(map);


    map.addControl( new L.Control.Search({
      url: 'https://nominatim.openstreetmap.org/search?format=json&accept-language=de-DE&q={s}',
      jsonpParam: 'json_callback',
      propertyName: 'display_name',
      propertyLoc: ['lat','lon'],
      markerLocation: true,
      autoType: false,
      autoCollapse: true,
      minLength: 2,
      zoom:16,
      text: 'Buscar dirección ó lat long',
      textCancel: 'Cancelar',
      textErr: 'No encontrado... ',
      position: 'topleft'
    }) );
    //marker: L.circleMarker([0,0],{radius:30}),

  //L.control.locate({showCompass:true,icon:"fa fa-crosshairs"}).addTo(map);


  // to munLayer Search
    var searchControlMun = new L.Control.Search({
      layer: munLayer,
      propertyName: 'municipio',
      zoom:9,
      circleLocation: false,
      text: 'Municipio a buscar',
      textCancel: 'Cancelar',
      textErr: 'Municipio NO encontrado... ',
      position: 'topright'
    });

      searchControlMun.on('search_locationfound', function(e) {
          e.layer.setStyle({fillcolor: 'red', color: '#0f0'});
          e.layer.setStyle(highlight);  //highlights selected.
      })
    map.addControl(searchControlMun);


/*
    // to reciLayer Search
    var searchControlReci = new L.Control.Search({
      layer: reciLayer,
      propertyName: 'recinto',
      zoom:12,
      text: 'Recinto Electoral a buscar',
      textCancel: 'Cancelar',
      textErr: 'Recinto NO encontrado... ',
      position: 'topright'
    });
    map.addControl(searchControlReci);   // add control & checked locLayer
*/

    //Plugin magic goes here! Note that you cannot use the same layer object again, as that will confuse the two map controls
    var osm2 = new L.TileLayer(osmUrl, {minZoom: 0, maxZoom: 13, attribution: osmAttrib });

    var rect1 = {color: "#ff1100", weight: 3};
    var rect2 = {color: "#0000AA", weight: 1, opacity:0, fillOpacity:0};
    var miniMap = new L.Control.MiniMap(osm2, { toggleDisplay: true, aimingRectOptions : rect1, shadowRectOptions: rect2}).addTo(map);


    // add marker & popup with coord
    var marker = L.marker([0,0]);

    map.on('contextmenu',
      function mapContextmenuListen(e) {
        var pos = e.latlng;
        marker = L.marker(
          pos, {
            draggable: true
          }
        );
        marker.on('dragstart', function(e) {
          map.off('contextmenu', mapContextmenuListen);
        });

        marker.on('dragend', function(event) {
          var position = marker.getLatLng();
          marker.setLatLng(position, {
            draggable: 'true'
          }).bindPopup(position).update();

          setTimeout(function() {
            map.on('contextmenu', mapContextmenuListen);
          }, 10);
        });

        //marker.addTo(map);
        map.addLayer(marker);
        marker.on('click', markerOnClick);
      }
    );
}
</script>



<div class="container">
    <h2 class="text-center text-blue pt-5" >Recinto Electoral</h2>
    <br>

    <!--
    <input id="imun" name="mun" type="hidden" value="{{ gj_mun }}">
    <input id="iprov" name="prov" type="hidden" value="{{ gj_prov }}">
    <input id="icir" name="cir" type="hidden" value="{{ gj_cir }}">
    -->

    <form class="needs-validation" action="{{ url_for('recinto', idreci = rc.reci, idlocreci = rc.idlocreci) }}" novalidate method='POST' onsubmit="return Validation(this)" name="form">
        <div class="form-row">
            <div class="col-md-3">
                <label for="latitud">Latitud:</label>
                <input type="text" class="form-control" id="ilatitud" title="" placeholder="Introduzca latitud" name="latitud"  required pattern="^-?([1-8]?[1-9]|[1-9]0)\.{1}\d{1,6}"
                        {% if load %}
                            value="{{ rc.latitud }}"
                        {% endif %}
                    >
                <div class="invalid-feedback">Debe introducir una coordenada válida.</div>
            </div>
            <div class="col-md-3">
                <label for="longitud">Longitud:</label>
                <input type="text" class="form-control" id="ilongitud" title="" placeholder="Introduzca longitud" name="longitud"  required pattern="^-?([1-8]?[1-9]|[1-9]0)\.{1}\d{1,6}" onkeydown="getgeo(event)"
                        {% if load %}
                            value="{{ rc.longitud }}"
                        {% endif %}
                    >
                <div class="invalid-feedback">Debe introducir una coordenada válida.</div>
            </div>
            <div class="col-md-2">
            </div>
            <div class="col-md-4">
                <label for="">.</label>
                <!--<button type='button' class="btn btn-info btn-md btn-block" onclick="getgeo(event)" >Visualizar imágen Satelital</button>-->
                <button type='button' class="btn btn-info btn-md btn-block" onclick="viewMap(event)" >Visualizar imágen Satelital</button>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-md-1">
                <label for="dep">DEP:</label>
                <input type="text" class="form-control" id="ideploc" title="" placeholder="DEP" name="deploc"  readonly required pattern="[0-9]{1}"
                        {% if load %}
                            value="{{ rc.deploc }}"
                        {% endif %}
                    >
                <div class="invalid-feedback">Debe introducir DEP.</div>
            </div>
            <div class="col-md-2">
                <label for="departamento">Departamento:</label>
                <input type="text" class="form-control" id="idepartamento" title="" placeholder="departamento" name="departamento" disabled
                        {% if load %}
                            value="{{ rc.nomdep }}"
                        {% endif %}
                    >
            </div>

            <div class="col-md-1">
                <label for="prov">PROV:</label>
                <input type="text" class="form-control" id="iprovloc" title="" placeholder="PROV" name="provloc"  readonly required pattern="[0-9]{1}"
                        {% if load %}
                            value="{{ rc.provloc }}"
                        {% endif %}
                    >
                <div class="invalid-feedback">Debe introducir PROV.</div>
            </div>
            <div class="col-md-2">
                <label for="provincia">Provincia:</label>
                <input type="text" class="form-control" id="iprovincia" title="" placeholder="provincia" name="provincia" disabled
                        {% if load %}
                            value="{{ rc.nomprov }}"
                        {% endif %}
                    >
            </div>

            <div class="col-md-1">
                <label for="sec">SEC:</label>
                <input type="text" class="form-control" id="isecloc" title="" placeholder="SEC" name="secloc"  readonly required pattern="[0-9]{1}"
                        {% if load %}
                            value="{{ rc.secloc }}"
                        {% endif %}
                    >
                <div class="invalid-feedback">Debe introducir SEC.</div>
            </div>
            <div class="col-md-4">
                <label for="municipio">Municipio:</label>
                <input type="hidden" name="muni" id="imuni" value="{{ rc.nomsec }}">
                <input type="text" class="form-control" id="imunicipio" title="" placeholder="municipio" name="municipio" disabled
                        {% if load %}
                            value="{{ rc.nomsec }}"
                        {% endif %}
                    >
            </div>
            <div class="col-md-1">
                <label for="circun">CIR:</label>
                <input type="text" class="form-control" id="icircun" title="" placeholder="Circun." name="circun"  readonly required pattern="[0-9]{1}"
                        {% if load %}
                            value="{{ rc.circundist }}"
                        {% endif %}
                    >
                <div class="invalid-feedback">Debe introducir CIRCUN.</div>
            </div>
        </div> <!--row-->
        <br>
        <div class="row">
            <div class="col-md-3">
                <label for="">.</label>
                <button type='button' class="btn btn-info btn-md btn-block" onclick="getgeoreci1(event)" >Ver Asientos / Zonas</button>
            </div>
            <div class="col-md-3">
                <label for="asiento">Asientos del Municipio:</label>
                <input type="hidden" name="reci_idasiento" id="ireci_idasiento" value="{{ rc.idlocreci }}">
                <input type="hidden" name="load" id="iload" value="{{ load }}">
                <select id="iasiento" name="asiento" class="form-control" onchange="cargar(this.value, 5);" required>
                    {% for asientoReci in asientoRecis %}
                        {% if rc.deploc==asientoReci[0] and rc.provloc==asientoReci[1] and rc.secloc==asientoReci[2] %}
                            {% if load %}
                                {% if rc.idlocreci==asientoReci[3] %}
                                        <option value = "{{ rc.circundist~':'~asientoReci[3] }}" selected>{{ asientoReci[4] }}</option>
                                {% endif %}
                            {% else %}
                                {% if rc.idlocreci==asientoReci[3] %}
                                        <option value = "{{ rc.circundist~':'~asientoReci[3] }}" selected>{{ asientoReci[4] }}</option>
                                {% else %}
                                        <option value = "{{ rc.circundist~':'~asientoReci[3] }}">{{ asientoReci[4] }}</option>
                                {% endif %}
                            {% endif %}
                       {% endif %}                                                     
                    {% endfor %}        
                </select>
                <div class="invalid-feedback">Debe Seleccionar un Asiento...</div>
            </div>
            <div class="col-md-4">
                <label for="zonareci">Zona del Recinto:</label>
                <input type="hidden" name="reci_idzona" value="{{ rc.zonareci }}">
                <select id="izonareci" name="zonareci" class="form-control" required>                          
                    <option></option>
                    {% for zonasreci in zonasRecis %}
                        {% if rc.idlocreci==zonasreci[0] and rc.circundist==zonasreci[3] %}
                            {% if load and rc.zonareci==zonasreci[1] %}
                                    <option value = "{{ zonasreci[1] }}" selected>{{ zonasreci[2]~' - '~zonasreci[3]~'('~'Cir '~zonasreci[3]~')' }}</option>
                            {% else %}
                                    <option value = "{{ zonasreci[1] }}">{{ zonasreci[2]~' - '~zonasreci[3]~'('~'Cir '~zonasreci[3]~')' }}</option>
                            {% endif %}
                        {% endif %}                                                                
                    {% endfor %}
                </select>
                <div class="invalid-feedback">Debe Seleccionar la Zona del Recinto...</div>
            </div>
            <div class="col-md-2">
                <label for="zonareci">Zona y Distrito:</label>
                <button type="button" class="btn btn-info btn-block openBtn">Registrar</button>
            </div>
        </div> <!--row-->

        <br>
        <div class="row">
            <div class="col-lg-12">
            <div id="dmap" style="width: 1110px; height: 600px;"></div>
            </div>
        </div>

        <br>
        <div class="row">
            <div class="col-md-1">
                <label for="idloc">IdLoc:</label>
                <input type="text" class="form-control" id="iidloc" title="" placeholder="IdLoc" name="idloc" disabled
                        {% if load %}
                            value="{{ rc.idlocreci }}"
                        {% endif %}
                    >
            </div>
            <div class="col-md-1">
                <label for="reci">Reci:</label>
                <input type="text" class="form-control" id="ireci" title="" placeholder="Reci" name="reci" disabled
                        {% if load %}
                            value="{{ rc.reci }}"
                        {% endif %}
                    >
            </div>
            <div class="col-md-7">
                <label for="nomreci">Recinto ELectoral:</label>
                <input type="text" class="form-control" id="inomreci" title="" placeholder="Introduzca nombre de Recinto" name="nomreci"  required 
                        {% if load %}
                            value="{{ rc.nomreci }}"
                        {% endif %}
                    >
                <div class="invalid-feedback">Debe introducir un nombre válido.</div>
            </div>
            <div class="col-md-3">
                <label for="iestado">Estado</label>
                <select id="iestado" name="estado" class="form-control" required>
                    <option></option>
                    {% for estado in estados %}
                        {% if load and rc.estado==estado[0] %}
                                <option value = "{{ estado[0] }}" selected>{{ estado[1] }}</option>
                        {% else %}
                                <option value = "{{ estado[0] }}">{{ estado[1] }}</option>
                        {% endif %}                                                                
                    {% endfor %}
                </select>
                <div class="invalid-feedback">Debe Seleccionar el Estado...</div> 
            </div>
        </div> <!--row-->
        <br>
        <div class="row">
            <div class="col-md-4">
                <label>Tipo de Recinto</label>
                <select id="itiporeci" name="tiporeci" class="form-control" onchange="carg(this);">
                    <option></option>
                    {% for trecinto in trecintos %}
                        {% if load and rc.tiporecinto==trecinto[0] %}
                                <option value = "{{ trecinto[0] }}" selected>{{ trecinto[1] }}</option>
                        {% else %}
                                <option value = "{{ trecinto[0] }}">{{ trecinto[1] }}</option>
                        {% endif %}                                                                
                    {% endfor %}
                </select>
                <div class="invalid-feedback">Debe Seleccionar el Tipo de Recinto...</div>
            </div>
            <div class="col-md-2">
                <label for="ruereci">Cod. RUE:</label>
                <input type="text" class="form-control" id="iruereci" title="" placeholder="Introduzca codigo RUE." name="ruereci"  required pattern="^ *\d[\d ]*$"
                        {% if load and rc.codrue != '0' %}
                            enabled value="{{ rc.codrue }}"
                         {% else %}
                            disabled   
                        {% endif %}
                    >
                <div class="invalid-feedback" id="v_poblacionloc">Debe introducir un dato válido.</div>
            </div>
            <div class="col-md-2">
                <label for="edireci">Cod. Edificio:</label>
                <input type="text" class="form-control" id="iedireci" title="" placeholder="Introduzca codigo del Edificio" name="edireci"  required pattern="^ *\d[\d ]*$"
                        {% if load and rc.codrueedif != '0' %}
                            enabled value="{{ rc.codrueedif }}"
                         {% else %}
                            disabled
                        {% endif %}
                    >
                <div class="invalid-feedback" id="v_poblacionelecloc">Debe introducir un dato válido.</div>
            </div>
            <div class="col-md-4">
                <label for="depenreci">Tipo de Dependencia:</label>
                <input type="hidden" name="reci_iddepen" value="">                          
                <select id="idepenreci" name=depenreci class="form-control" required
                        {% if load and rc.codrueedif != '0' %}
                                enabled
                         {% else %}
                                disabled
                        {% endif %}
                        >
                        <option></option>                                                          
                        <option value=63 
                            {% if load  and rc.depend == 63 %}
                                    selected  
                            {% endif %}
                        >Particular</option>
                        <option value=64
                            {% if load  and rc.depend == 64 %}
                                    selected                                 
                            {% endif %}
                        >Fiscal</option>
                        <option value=65
                            {% if load  and rc.depend == 65 %}
                                    selected
                            {% endif %}
                        >Convénio</option>
                        <option value=66
                            {% if load  and rc.depend == 66 %}
                                    selected 
                            {% endif %}
                        >Otro</option>
                </select>
                <div class="invalid-feedback">Debe Seleccionar un Tipo de Dependencia...</div>
            </div>
        </div> <!--row-->
        <br>
        <div class="row">
            <div class="col-md-2">
                <label for="pisosreci">Cantidad de Pisos:</label>
                <input type="text" class="form-control" id="ipisosreci" title="" placeholder="Introduzca cantidad de pisos" name="pisosreci"  required pattern="^ *\d[\d ]*$" onkeypress="return validacionPisos(event)"
                        {% if load %}
                            value="{{ rc.cantpisos }}"
                        {% endif %}
                    >
                <div class="invalid-feedback">Debe introducir un dato válido.</div>
            </div>
            <div class="col-md-2">
                <label for="mesasreci">Mesa(max.):</label> 
                <input type="text" class="form-control" id="imesasreci" title="" placeholder="Max." name="mesasreci"  required pattern="^ *\d[\d ]*$"  onkeypress="return validacionMax(event)"
                        {% if load %}
                            value="{{ rc.maxmesasreci }}"
                        {% endif %}
                    >
                <div class="invalid-feedback" id="v_poblacionloc">Debe introducir un dato válido.</div>
            </div>
            <div class="col-md-8">
                <label for="dirreci">Dirección del Recinto:</label>
                <input type="text" class="form-control" id="idirreci" title="" placeholder="Introduzca descripción de ubicación" name="dirreci" required  
                        {% if load %}
                            value="{{ rc.direccion }}"
                        {% endif %}
                    >
                <div class="invalid-feedback">Debe introducir la Dirección.</div>
            </div>
        </div> <!--row-->
        <br>
        <div class="row">
            <div class="col-md-6">
                <label for="ietapa">Etapa</label>
                <select id="ietapa" name="etapa" class="form-control" onchange="carg1(this);">
                    <option value=70 
                        {% if load  and rc.etapa == 70 %}
                            selected 
                        {% endif %}
                    >Propuesta</option>
                    <option value=71 
                        {% if load  and rc.etapa == 71 %}
                            selected 
                        {% endif %}
                    >Devuelto</option>
                    {% if usrdep == 0 %}
                        <option value=72
                            {% if load  and rc.etapa == 72 %}
                                selected 
                            {% endif %}
                        >Revisión</option>
                        <option value=73
                            {% if load  and rc.etapa == 73 %}
                                selected 
                            {% endif %}
                        >Aprobado</option>
                        <option value=74
                            {% if load  and rc.etapa == 74 %}
                                selected 
                            {% endif %}
                        >Aprobado con Correpción</option>
                    {% endif %}
                </select> 
            </div>
            <div class="col-md-5">
                <label for="docAct">Documento Actualización:</label>
                <input type="hidden" name="doc_idAct" value="">
                <select id="idocAct" name="docAct" class="form-control" required>                          
                    <option></option>
                    {% for tpdfA in tpdfsA %}
                        {% if load and rc.doc_idA == tpdfA[0] %}
                                <option value = "{{ tpdfA[0] }}" selected>{{ '<'~tpdfA[1]~'> '~': '~tpdfA[2]~' _ '~tpdfA[3] }}</option>
                        {% else %}
                                <option value = "{{ tpdfA[0] }}">{{ '<'~tpdfA[1]~'> '~': '~tpdfA[2]~' _ '~tpdfA[3] }}</option>
                        {% endif %}                                                                
                    {% endfor %}
                </select>
                <div class="invalid-feedback">Debe Seleccionar un Tipo de Documento...</div>
            </div>
            <div class="col-md-1"><a href="{{ rc.rutaA }}" target="_blank">
                                    {% if load %}
                                        <i class="fas fa-file-pdf" style="font-size: 25px;display: inline-block; margin-top: 40px;"></i>
                                    {% endif %}
                                 </a></div>
        </div> <!--row-->
        <div class="row">
            <div class="col-md-6">
                <!--columna vacia-->                
            </div>
            <div class="col-md-5">
                <label for="docAct">Documento Actualización Final:</label>
                <select id="idocActF" name="docActF" class="form-control" required disabled>                          
                    <option></option>
                    {% for tpdfA in tpdfsA %}
                        {% if load and rc.doc_idAF == tpdfA[0] %}
                                <option value = "{{ tpdfA[0] }}" selected>{{ '<'~tpdfA[1]~'> '~': '~tpdfA[2]~' _ '~tpdfA[3] }}</option>
                        {% else %}
                                <option value = "{{ tpdfA[0] }}">{{ '<'~tpdfA[1]~'> '~': '~tpdfA[2]~' _ '~tpdfA[3] }}</option>
                        {% endif %}                                                                
                    {% endfor %}
                </select>
                <div class="invalid-feedback">Debe Seleccionar un Tipo de Documento...</div>
            </div>
            <div class="col-md-1"><a href="{{ rc.rutaAF }}" target="_blank">
                                    {% if load %}
                                        <i class="fas fa-file-pdf" style="font-size: 25px;display: inline-block; margin-top: 40px;"></i>
                                    {% endif %}
                                 </a></div>
        </div> <!--row-->

        <br>
        <div class="row">
            <div class="col-md-3">
                <label for="fechaIngreso">Fecha Ingreso al Sistema:</label>
                <input type="datetime" class="form-control" id="ifechaIngreso" title="" placeholder="Fecha de Ingreso." name="fechaIngreso" readonly "  
                        {% if load %}
                            value="{{ rc.fechaIngreso }}"
                        {% else %}
                            value="{{ idatetime }}"
                        {% endif %}
                    >
                <div class="invalid-feedback">Debe introducir una fecha válida.</div>
            </div>
            <div class="col-md-3">
                <label for="fechaAct">Fecha Actualización:</label>
                <input type="datetime" class="form-control" id="ifechaAct" title="" placeholder="Fecha de Actualización" name="fechaAct" readonly "  
                        {% if load %}
                            value="{{ rc.fechaAct }}"
                        {% else %}
                            value="{{ idatetime }}"
                        {% endif %}
                    >
                <div class="invalid-feedback">Debe introducir una fecha válida.</div>
            </div>
            <div class="col-md-6">
                <label for="usuario">Usr.que realizó la última actualización:</label>
                <input type="text" class="form-control" id="iusuario" title="" placeholder="Usuario" name="usuario"  readonly "
                        {% if load %}
                            value="{{ rc.usuario }}"
                        {% else %}
                            value="{{ usuario }}"
                        {% endif %}
                    >
                <div class="invalid-feedback">Debe introducir un nombre válido.</div>
            </div>
        </div> <!--row-->

        <br>

        <div class="row">
            <div class="col-md-6">
                <button type="button"  onclick="javascript: window.location.href = '/recintos_list';"  class="btn btn-outline-danger btn-lg btn-block">Cancelar</button>
            </div>
            <div class="col-md-6">
                <button type="submit" class="btn btn-outline-success btn-lg btn-block" id="iaceptar" 
                    {% if puede_editar %}
                        enabled
                    {% else %}
                        disabled
                    {% endif %}
                >Aceptar</button>
            </div>
        </div> <!--row-->

    </form>

    {% if error %}
    <br>
    <div class="alert alert-danger alert-dismissible fade show">
        <strong>Error!</strong> {{ error }} 
        <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
</div> <!--main-->

<script>
    var ruereci = document.getElementById('iruereci');
    var edireci = document.getElementById('iedireci');
    var depenreci = document.getElementById('idepenreci');

    function carg(elemento) {
      d = elemento.value;
      if(d == 7){
        ruereci.disabled = false;
        edireci.disabled = false;
        depenreci.disabled = false;
        ruereci.focus();
      }else{
        ruereci.disabled = true;
        edireci.disabled = true;
        depenreci.disabled = true;
        ruereci.value="";
        edireci.value="";
        document.getElementById('idepenreci').selectedIndex = 0;
      }
    }

    var input = document.getElementById('idocActF');

    function carg1(elemento) {
      d = elemento.value;
      console.log(d);
      if(d == 74){
        input.disabled = false;
      }else{
        input.disabled = true;
      }
    }

    $('.openBtn').on('click',function(){
        $('.modal-body').load('/zona1.html',function(){
            $('#exampleModal').modal({show:true});
        });
    });
    // Disable form submissions if there are invalid fields
    (function() {
        'use strict';
        window.addEventListener('load', function() {
            // Get the forms we want to add validation styles to
            var forms = document.getElementsByClassName('needs-validation');
            // Loop over them and prevent submission
            var validation = Array.prototype.filter.call(forms, function(form) {
                form.addEventListener('submit', function(event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();

    function validacionMax(event) {
      var key = event.which || event.keyCode;
      /* Observamos el resultado que generará la tecla */
      var max = parseInt(form.mesasreci.value + String.fromCharCode(key)
      );
      /* Si no está dentro de lo esperado cancelamos la pulsación */
      if (isNaN(max) === true || max < 1 || max > 300) {
        return false;
      }
      return true;
    }

    function validacionPisos(event) {
      var key = event.which || event.keyCode;
      /* Observamos el resultado que generará la tecla */
      var max = parseInt(form.pisosreci.value + String.fromCharCode(key)
      );
      /* Si no está dentro de lo esperado cancelamos la pulsación */
      if (isNaN(max) === true || max < 1 || max > 10) {
        return false;
      }
      return true;
    }

    // Below Function Executes On Form Submit
    function Validation(f) {
        if (f.tiporeci.value == '') {
            alert('Debe especificar tipo de Recinto...');
            return false;
        }
        if (f.muni.value != "" && f.muni.value != f.municipio.value) {
            alert('Las nuevas coordenadas apuntan otro Municipio...');
            return false;
        }
        
        return true;
    }
</script>

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="row justify-content-center align-items-center">
        <div class="col-md-11">  
          <h2 class="text-center text-blue pt-3" >{{ titulo }}</h2>  
          <div class="modal-body">
            <div id="successAlert" class="alert alert-success" role="alert" style="display:none; text-align: center;"></div>
            <div id="errorAlert" class="alert alert-danger" role="alert" style="display:none; text-align: center;"></div>    
            <form id="myForm" class="needs-validation" novalidate method="POST" action="javascript:void();" onsubmit="return enviar();">                
                <div class="row">
                    <div class="col-md-3">
                        <label for="idloc">IdLoc:</label>
                        <input type="text" class="form-control" id="iidlocreci" title="" placeholder="Instroduzca IdLoc" name="idlocreci" required readonly 
                                {% if load %}
                                    value="{{ rc.idlocreci }}"
                                {% endif %}
                            >
                        <div class="invalid-feedback">Ingrese codigo IdLoc...</div>
                    </div>
                    <div class="col-md-3">
                        <label for="nomzona">Refresh:</label>
                        <button type="button" class="btn btn-light btn-block"><a onclick="cargar(this.value, 7)"><i class="fas fa-sync-alt" style="font-size: 25px;"></i></a></button>
                    </div>
                    <div class="col-md-6">
                    </div>
                </div> <!--row-->
                <br>
                <div class="row">
                    <div class="col-md-12">
                        <label for="nomzona">Nombre de la Zona:</label>
                        <input type="text" class="form-control" id="inomzona" placeholder="Introduzca la Zona" name="nomzona" required
                            {% if load %}
                                value=""        
                            {% endif %}
                        >
                        <div class="invalid-feedback">Por favor ingrese la Zona...</div>
                    </div>
                </div>
                <h5 class="text-left text-blue pt-5" >Datos del Distrito (Circunscripción):</h5>
                <div class="row">
                    <div class="col-md-2">
                        <label for="nrodist">Circun.:</label>
                        <input type="text" class="form-control" id="inrodist" placeholder="Nro." name="nrodist" required readonly
                            {% if load %}
                                value="{{ rc.circundist }}"        
                            {% endif %}
                        >
                        <div class="invalid-feedback">Por favor ingrese El Nro. del Distrito...</div>
                    </div>
                    <div class="col-md-7">
                        <label for="nomdist">Nombre del Distrito:</label>
                        <select id="inomdist" name="nomdist" class="form-control" required>
                        </select>
                        <div class="invalid-feedback">Debe Seleccionar el Distrito...</div>
                    </div>
                    <div class="col-md-3">
                        <label for="nomdist">Nuevo Dist</label>
                        <button type="button" class="btn btn-light btn-block"><a href="javascript:void();" onclick="document.getElementById('form1').submit();"><span class="fas fa-university" style="font-size: 25px;"></span></a></button>
                    </div>
                </div>
                <br>
                <div class="row">
                    <div class="col-md-4">
                        <label for="fechaIngreso">Registro:</label>
                        <input type="datetime" class="form-control" id="ifechaIngresoM" title="" placeholder="Fecha de Registro." name="fechaIngresoM" readonly
                                {% if load_d %}
                                    value=""
                                {% else %}
                                    value="{{ idatetime }}"
                                {% endif %}
                            >
                        <div class="invalid-feedback" id="v_fechaIngreso">Debe introducir una fecha válida.</div>
                    </div>
                    <div class="col-md-4">
                        <label for="fechaAct">Actual:</label>
                        <input type="datetime" class="form-control" id="ifechaActM" title="" placeholder="Fecha Actual." name="fechaActM" readonly
                                {% if load_d %}
                                    value=""
                                {% else %}
                                    value="{{ idatetime }}"
                                {% endif %}
                            >
                        <div class="invalid-feedback" id="v_fechaAct">Debe introducir una fecha válida.</div>
                    </div>                        
                    <div class="col-md-4">
                        <label for="usuario">Usuario:</label>
                        <input type="text" class="form-control" id="iusuario" title="" placeholder="Usuario" name="usuario"  readonly 
                                {% if load_d %}
                                    value=""
                                {% else %}
                                    value="{{ usuario }}"
                                {% endif %}
                            >
                        <div class="invalid-feedback">Debe introducir un nombre válido.</div>
                    </div>
                </div>

                <br>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <button type="button" id="cerrar" onclick="cerrarmodal();" class="btn btn-outline-danger btn-md btn-block" data-dismiss="modal">Cerrar</button>
                    </div>
                    <div class="col-md-6 mb-3">
                        <button type="submit" id="button" class="btn btn-outline-success btn-md btn-block" 
                        >Aceptar</button>
                    </div>
                </div> <!--row-->
            </form>
          </div>
        </div>  
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
    function enviar(){
        var valor = document.getElementById("inomzona").value;
        if( valor == null || valor.length == 0 || /^\s+$/.test(valor) ) {
          return false;
        }
        var indice = document.getElementById("inomdist").selectedIndex;
        if( indice == null || indice == 0 ) {
          return false;
        }
        var idloc = document.getElementById('iidlocreci').value;
        var nomzona = document.getElementById('inomzona').value;
        var circundist = document.getElementById('inrodist').value;
        var nomdist = document.getElementById('inomdist').value;
        var fingreso = document.getElementById('ifechaIngresoM').value;
        var factual = document.getElementById('ifechaActM').value;
        var usuario = document.getElementById('iusuario').value;
        var dataenv = 'idloc='+idloc +'&nomzona='+nomzona +'&circundist='+circundist +'&nomdist='+nomdist +
                      '&fingreso='+fingreso +'&factual='+factual + '&usuario='+usuario;
        $.ajax({
            type: 'POST',
            url: '/zonasr',
            data: dataenv
        })
        .done(function(data) {
            if (data.error) {
                $('#errorAlert').text(data.error).show();
                $('#successAlert').hide();
            }
            else {
                $('#successAlert').text(data.name).show();
                $('#errorAlert').hide();
                document.getElementById('inomzona').value = "";
                document.getElementById('inomdist').selectedIndex = 0;
            }
        });
        setTimeout(function(){
               $('#exampleModal').modal('hide');
               $('#successAlert').hide();
               $('#errorAlert').hide();
               $('#iasiento').html('');
               $("#iasiento").append('<option></option>');
               $('#izonareci').html('');
               $("#izonareci").append('<option></option>');
        }, 3000);
        /*$('#button').submit(function(e) {
               e.preventDefault();
               $('#exampleModal').modal('hide');
               return false;
        });*/
    }
    function cerrarmodal(){
        $("#iasiento").val('0');
        $('#izonareci').html('');
        $("#izonareci").append('<option></option>');
        window.close();
    }
</script>
<!-- Otro Modal -->

<div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="row justify-content-center align-items-center">
        <div class="col-md-11">  
          <h2 class="text-center text-blue pt-3" >{{ titulo }}</h2>  
          <div class="modal-body">    
            <form id="form1" action="{{ url_for('zonasre') }}" target="_blank" class="needs-validation" novalidate method="POST">
                <input type="hidden" name="nomloc" value="{{ rc.nomloc }}">                
                <div class="row">
                    <div class="col-md-3">
                        <label for="idloc">IdLoc:</label>
                        <input type="text" class="form-control" id="iidlocreci1" title="" placeholder="Instroduzca IdLoc" name="idlocreci1" required readonly 
                                {% if load %}
                                    value="{{ rc.idlocreci }}"
                                {% endif %}
                            >
                        <div class="invalid-feedback">Ingrese codigo IdLoc...</div>
                    </div>
                    <div class="col-md-9">
                    </div>
                </div> <!--row-->
                <div class="row">
                    <div class="col-md-2">
                        <label for="nrodist">Circun.:</label>
                        <input type="text" class="form-control" id="inrodist1" placeholder="Nro." name="nrodist1" required readonly
                            {% if load %}
                                value="{{ rc.circundist }}"        
                            {% endif %}
                        >
                        <div class="invalid-feedback">Por favor ingrese El Nro. del Distrito...</div>
                    </div>
                    <div class="col-md-10">
                        <label for="nomdist">Nombre del Distrito:</label>
                        <select id="inomdist" name="nomdist" class="form-control">
                        </select>
                        <div class="invalid-feedback">Debe Seleccionar el Distrito...</div>
                    </div>
                </div>
            </form>
          </div>
        </div>  
      </div>
    </div>
  </div>
</div>


{% endblock %}
<!--https://programacion.net/articulo/como_cargar_contenido_dinamico_en_un_modal_de_bootstrap_1867-->


